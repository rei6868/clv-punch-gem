name: Check Punch Status
on:
  workflow_dispatch: # Cho ph√©p ch·∫°y th·ªß c√¥ng
  schedule:
    # C·∫¨P NH·∫¨T: Ch·∫°y l√∫c 00:00 UTC (7:00 S√°ng VN) - Th·ª© Ba, Th·ª© T∆∞
    - cron: '0 0 * * 2,3'

jobs:
  check-status-and-notify:
    name: Check Status and Notify
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: 1. Check out repository
        uses: actions/checkout@v4

      - name: 2. Check Automation Status
        id: check_config
        run: |
          sudo apt-get install -y jq
          IS_ENABLED=$(jq '.isAutomationEnabled' config.json)
          echo "Automation enabled: $IS_ENABLED"
          echo "is_enabled=$IS_ENABLED" >> $GITHUB_OUTPUT

      - name: 3. Send Warning Notification if Disabled
        if: steps.check_config.outputs.is_enabled == 'false'
        run: |
          curl -X POST -H 'Content-Type: application/json' \
          '${{ secrets.GOOGLE_CHAT_WEBHOOK_URL }}' \
          -d '{
                "cardsV2": [
                  {
                    "cardId": "reminder-card-disabled",
                    "card": {
                      "header": {
                        "title": "üö® C·∫¢NH B√ÅO: Auto-Punch ƒêang T·∫ÆT",
                        "subtitle": "Ph√°t hi·ªán l√∫c 7:00 AM",
                        "imageUrl": "https://i.imgur.com/A53t3zP.png",
                        "imageType": "CIRCLE"
                      },
                      "sections": [
                        {
                          "widgets": [
                            {
                              "textParagraph": {
                                "text": "H·ªá th·ªëng Auto-Punch (WFH) ƒëang ·ªü tr·∫°ng th√°i T·∫ÆT (Disabled).<br><br>B·∫°n <b>ƒë√£ b·ªã l·ª°</b> l∆∞·ª£t punch-in l√∫c 6:00 s√°ng nay.<br><br>Vui l√≤ng <b>b·∫≠t l·∫°i</b> h·ªá th·ªëng ngay l·∫≠p t·ª©c (ho·∫∑c t·ª± punch-in th·ªß c√¥ng)."
                              }
                            }
                          ]
                        }
                      ]
                    }
                  }
                ]
              }'
