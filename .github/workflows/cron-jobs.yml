# File: .github/workflows/cron-jobs.yml
name: Vercel Cron Triggers (via GHA)

on:
  workflow_dispatch:
  schedule:
    # (Giờ UTC = Giờ VN - 7)

    # 1. Daily Reset (00:05 VN)
    - cron: '5 17 * * *' # 17:05 UTC

    # 2. WFH AM Reminders (T3, T4)
    # 06:10, 06:20, 06:40 (VN)
    - cron: '10 23 * * 1,2' # 23:10 UTC (T2, T3)
    - cron: '20 23 * * 1,2' # 23:20 UTC (T2, T3)
    - cron: '40 23 * * 1,2' # 23:40 UTC (T2, T3)
    # 07:00, 07:20, 07:40, 08:10, 08:30 (VN)
    - cron: '0 0 * * 2,3' # 00:00 UTC (T3, T4)
    - cron: '20 0 * * 2,3' # 00:20 UTC (T3, T4)
    - cron: '40 0 * * 2,3' # 00:40 UTC (T3, T4)
    - cron: '10 1 * * 2,3' # 01:10 UTC (T3, T4)
    - cron: '30 1 * * 2,3' # 01:30 UTC (T3, T4) - FINAL DEADLINE

    # 3. Office Day Reminder (07:45 VN)
    # (T2, T5, T6, T7, CN)
    - cron: '45 0 * * 0,1,4,5,6' # 00:45 UTC

    # 4. WFH PM Reminders (T3, T4)
    # 18:05, 18:20, 18:40, 19:00, 20:00 (VN)
    - cron: '5 11 * * 2,3' # 11:05 UTC (T3, T4)
    - cron: '20 11 * * 2,3' # 11:20 UTC (T3, T4)
    - cron: '40 11 * * 2,3' # 11:40 UTC (T3, T4)
    - cron: '0 12 * * 2,3' # 12:00 UTC (T3, T4)
    - cron: '0 13 * * 2,3' # 13:00 UTC (T3, T4) - FINAL DEADLINE

    # 5. OFF Day Reminder (18:00 VN - Chạy HÀNG NGÀY)
    # (Logic trong API sẽ tự kiểm tra xem có OFF hay không)
    - cron: '0 11 * * *' # 11:00 UTC

jobs:
  trigger-vercel-reset:
    name: Trigger Vercel Cron (Reset)
    # Chỉ chạy job này nếu lịch là '5 17 * * *'
    if: github.event.schedule == '5 17 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Ping /api/cron-reset
        run: |
          curl --request POST \
            --url 'https://auto-punch.vercel.app/api/cron-reset' \
            --header 'Authorization: Bearer ${{ secrets.PUNCH_SECRET }}' \
            --header 'Content-Type: application/json' \
            --fail

  trigger-vercel-reminder:
    name: Trigger Vercel Cron (Reminder)
    # Chạy job này cho TẤT CẢ các lịch KHÁC
    if: github.event.schedule != '5 17 * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Ping /api/cron-reminder
        run: |
          curl --request POST \
            --url 'https://auto-punch.vercel.app/api/cron-reminder' \
            --header 'Authorization: Bearer ${{ secrets.PUNCH_SECRET }}' \
            --header 'Content-Type: application/json' \
            --fail