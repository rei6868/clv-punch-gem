name: Reminder to Enable Punch
on:
  workflow_dispatch: # Cho ph√©p ch·∫°y th·ªß c√¥ng
  schedule:
    # Ch·∫°y l√∫c 13:00 UTC (20:00 T·ªëi VN) - Th·ª© Hai, Th·ª© Ba
    - cron: '0 13 * * 1,2'

jobs:
  check-status-and-remind:
    name: Check Status and Remind
    runs-on: ubuntu-latest
    timeout-minutes: 2

    steps:
      - name: 1. Check out repository
        uses: actions/checkout@v4

      - name: 2. Check Automation Status
        id: check_config
        run: |
          sudo apt-get install -y jq
          IS_ENABLED=$(jq '.isAutomationEnabled' config.json)
          echo "Automation enabled: $IS_ENABLED"
          echo "is_enabled=$IS_ENABLED" >> $GITHUB_OUTPUT

      - name: 3. Send Warning Notification if Disabled
        if: steps.check_config.outputs.is_enabled == 'false' # Ch·ªâ ch·∫°y n·∫øu b·ªã T·∫ÆT
        run: |
          curl -X POST -H 'Content-Type: application/json' \
          '${{ secrets.GOOGLE_CHAT_WEBHOOK_URL }}' \
          -d '{
                "cardsV2": [
                  {
                    "cardId": "reminder-card-night",
                    "card": {
                      "header": {
                        "title": "üö® C·∫¢NH B√ÅO: Auto-Punch ƒêang T·∫ÆT",
                        "subtitle": "Ph√°t hi·ªán l√∫c 20:00 (8 gi·ªù t·ªëi)",
                        "imageUrl": "https://i.imgur.com/A53t3zP.png",
                        "imageType": "CIRCLE"
                      },
                      "sections": [
                        {
                          "widgets": [
                            {
                              "textParagraph": {
                                "text": "H·ªá th·ªëng Auto-Punch (WFH) ƒëang ·ªü tr·∫°ng th√°i T·∫ÆT (Disabled).<br><br>Vui l√≤ng <b>B·∫¨T l·∫°i</b> (d√πng iOS Shortcut) tr∆∞·ªõc khi ƒëi ng·ªß, n·∫øu kh√¥ng b·∫°n s·∫Ω <b>b·ªã l·ª°</b> l∆∞·ª£t punch-in l√∫c 6:00 s√°ng mai."
                              }
                            }
                          ]
                        }
                      ]
                    }
                  }
                ]
              }'
